---
title: How does human activity affect the movement patterns of wild animals?
subtitle: An analysis of selected datasets from the Movebank animal tracking database
author: Jannis Bolzern and Elke Michlmayr
format:
  html:
    code-fold: true
execute:
  warning: false
  message: false
lang: en
bibliography: bibliography.bib
---

```{r preprocessing}
#| code-summary: preprocessing
``` 

## Abstract

In this project, we aim to investigate how human activity influences the movement patterns of wild animals. Using GPS and Argos tracking data from red foxes, bobcats, and coyotes across rural and remote areas in England, Canada, and the US, we will analyze home range sizes, temporal activity shifts, and habitat selection in relation to human footprint and land use data.

## Introduction

Research questions:

1. **Access to Anthropogenic Food Sources:** Do animals in high human-impact areas exhibit smaller home ranges due to easier access to food resources?
2. **Temporal Shifts in Activity Patterns:** Do animals become more nocturnal in high human-impact areas to avoid direct human encounters?
3. **Habitat Selection in Human-Dominated Landscapes:** How do animals select habitats (e.g., forests, agriculture) under varying levels of human influence?

Additional challenges:

* We will be using data for purposes that it wasn't originally collected for.
* We will be comparing between data from different studies (foxes).
* We will be using parts of datasets (missing animals in the bobcat/coyote study).

## Material and Methods

### Datasets

We will use the following wild animal tracking data published on Movebank under a Creative Commons license by three different research groups (see references):

* **Red fox** data from @porteus2024movement for rural areas (outskirt areas of villages in Wiltshire, UK) will be compared to red fox data from @lai2022red for remote areas (uninhabitated islands Bylot and Herschel, Canada)
* **Bobcat** and **coyote** data from @prugh2023fear for remote areas with some rural structures (GPS-based, northern Washington, US)

For the human footprint data, we will use the **global 100 meter resolution terrestrial human footprint data (HFP-100)** by @gassert2023operational. The data can be read in Python, R, or any other script that has libraries that can interpret geospatial data (such as folium).

If required, for **land use** in Washington, US, we will rely on the General Land Use Final Dataset published by Washington Spatial Data ([link](https://geo.wa.gov/datasets/a0ddbd4e0e2141b3841a6a42ff5aff46_0/explore?location=48.347066%2C-118.420235%2C9.91)) and for land use in the UK on gov.uk data ([link](https://www.data.gov.uk/dataset/946ce540-de76-441e-bac8-624f30cace8a/land-cover-map-2021-10m-classified-pixels-gb)).

### Data preparation and processing

#### Movebank
We have used data from the Movebank database and system by @kays2022movebank. This simplifies data preparation since all the datasets have the same format and table definitions. A library for data ingestion and trajectory handling in R is provided by @bartk_move2.

```{r}
library("dplyr")
library("move2")
library("units")
library("rnaturalearth")

foxes_wiltshire <- movebank_download_study(
  study_id = 3179890710,
  sensor_type_id = c("gps"),
  'license-md5'='ffa36f79defe10eac9fe70f6502a17e0'
)
foxes_bylot <- movebank_download_study(
  study_id = 1371322147,
  'license-md5'='9559cb1b1cca51e9f3fd69812e5e22dc'
)
foxes_herschel <- movebank_download_study(
  study_id = 1371529289,
  'license-md5'='436e8205d0c2973115e2024b146a6ad5'
)
```

@laube2011 have found that the temporal scale affects the calculation of movement parameters. The speed, sinuosity and turning angle of animal trajectories will differ based on the sampling interval. We conclude that temporal scale could also affect home range results.

Therefore we need to check if the sampling intervals are similar between the datasets to ensure an apples-to-apples comparison. We also need to make sure that the datasets cover comparable time ranges.

The Wiltshire data was collected during the wader nesting season, which was defined to be 15 March to 15 June, from 2016 to 2019 for 35 foxes in total. It was sampled at 10 or 60 minute rates throughout the day. The research team had the option to select the sampling rate remotely. They used this to save battery at times the data was considered less interesting, such as times when foxes were known to be usually static. The Canadian data was collected all year round, but at a much lower sampling rate of just once per day from 2011 to 2015 (Bylot) and June 2009 to Feb 2010 (Herschel), at randomly different afternoon times of the day. It included a much lower number of foxes, two per island. @fig-datapoints-year provides an overview of the amount of data points available per year, demonstrating the fact that there is much more data from Wiltshire because of the higher number of foxes and also the higher sampling rate.

The time of day at which the data was collected poses an interesting challenge because it would not be reasonable to assume that foxes in remote area will follow the same daily patterns as the ones living in a rural area. These two groups will have different activity levels because in one case humans will be present in the afternoon and in the other case that will not happen. 

Given finding the selection of best data points to compare involves a complex choice that will influence the results, the first goal is to perform the simplest acceptable comparison. But what is that?

We can decide to compare the data for the same time of the year. @fig-datapoints-month shows that (1) the Herschel data can not be used because it does only minimally overlap with the wader nesting season and (2) there is much less data from Bylot for the wader nesting season compared to other times of the year. It could be that the foxes have different yearly activity patterns because of the seasonal differences between the locations.

We will do it anyway and compare the median animal home range between Wiltshire and Bylot for the wader season for all years there is data for (five for Bylot, four for Wiltshire) to find out if any conclusion can be drawn. 

TBD Note to self: When doing processing, be careful since the places are in different timezones. Also, there is a change from GMT to BST during the study period.

```{r}
#| label: red fox data investigation
#| include: false
library("lubridate")

counts_herschel <- data.frame(foxes_herschel) |> 
  mutate(source = as.character("Herschel")) |>
  select(source, timestamp)
st_drop_geometry(counts_herschel)
counts_bylot <- data.frame(foxes_bylot) |> 
  mutate(source = as.character("Bylot")) |>
  select(source, timestamp)
st_drop_geometry(counts_bylot)
counts_wiltshire <- data.frame(foxes_wiltshire) |> 
  mutate(source = as.character("Wiltshire")) |>
  select(source, timestamp)
st_drop_geometry(counts_wiltshire)

combined_data <- bind_rows(counts_herschel, counts_bylot, counts_wiltshire)
combined_data <- combined_data |>
  mutate(date = as.Date(timestamp), month = month(timestamp), year = as.integer(year(timestamp)))
year_count <- combined_data |>
  group_by(source, year) |>
  summarise(count = n())
month_count <- combined_data |>
  group_by(source, month) |>
  summarise(count = n())
```

```{r}
#| label: fig-datapoints-year
#| fig-cap: "Overview of the number of data points per year in the three different datasets"
#| echo: false
#| warning: false
ggplot(year_count, aes(x = factor(year), y = count, color = source)) +
  geom_bar(stat = "identity") +
  facet_wrap(~ source, scales = "free_y") +
  labs(title = "Number of data points per year per dataset",
       x = "Year", y = "# of timestamps") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90))
```

```{r}
#| label: fig-datapoints-month
#| fig-cap: "Overview of the number of data points per month in the three different datasets"
#| echo: false
#| warning: false
ggplot(month_count, aes(x = month, y = count, color = source)) +
  geom_point() +
  scale_x_continuous(breaks = 1:12, labels = 1:12) +
  facet_wrap(~ source, scales = "free_y") +
  labs(title = "Number of data points per month per dataset",
       x = "Month", y = "# of timestamps") +
  theme_minimal()
```

```{r}
# TBD: Why does this not work with the newer pipe? The dot is the issue
foxes_herschel_monthly <- foxes_herschel %>% mt_set_track_id(paste(mt_track_id(.),
    sep = "_", month.name[month(mt_time(.))]
  ))
```

```{r}
# TBD: filter_track_data doesn't seem to be fully functional
foxes_herschel |>
  filter_track_data(source == c("Herschel"))
```

```{r}
foxes_herschel %>%
  filter(!st_is_empty(.)) %>%
  mt_filter_per_interval(unit = "24 hours")
```

#### HRP-100

Use 2020 data and make a subset as quickly as possible

### Methodology

#### Trajectory Analysis:
Movement paths will be analyzed to identify patterns in speed, direction, and habitat use. Step lengths and turning angles will help infer behavioral states. Step-selection functions (SSFs) will model habitat preferences relative to availability, allowing us to quantify how animals respond to environmental covariates such as human footprint and land use.

#### Home Range Assessment:
Home range sizes will be calculated using kernel density estimation (KDE) and minimum convex polygons (MCPs). This will provide estimates of the area used by each individual. Home ranges will be compared across regions with varying levels of human activity to test whether access to anthropogenic food sources (e.g., household waste, crops) leads to smaller home ranges due to resource concentration.

TBD: There are several ways to calculate home range, we could compare (and could focus on only that)

TBD: Do this for foxes first, for bobcat and coyote data later, potentially even cross-species analysis


```{r}
library("ggplot2")
library("sf")

tracks = mt_track_lines(foxes_wiltshire)
mcp <- st_convex_hull(tracks)
area <- st_area(mcp)
print(area)
ggplot(mcp, aes(fill = individual_id)) +
  geom_sf(alpha = 0.4)

#c1_tracks = mt_track_lines(foxes_bylot)
#c1_mcp <- st_convex_hull(c1_tracks)
#print(c1_area)
#c1_area <- st_area(c1_mcp)
#ggplot(c1_mcp, aes(fill = individual_id)) +
#  geom_sf(alpha = 0.4)

#c2_tracks = mt_track_lines(foxes_herschel)
#c2_mcp <- st_convex_hull(c2_tracks)
#c2_area <- st_area(c2_mcp)
#print(c2_area)
#ggplot(c2_mcp, aes(fill = individual_id)) +
#  geom_sf(alpha = 0.4)
```

#### Temporal Activity Patterns:
Movement rates will be used to quantify diel activity shifts. We will test whether animals in high human-impact areas exhibit increased nocturnality, potentially as a strategy to avoid direct human encounters. This analysis will reveal how temporal behavior adapts to human presence.

#### Habitat Selection:
SSFs will quantify selection for human-modified habitats (e.g., agricultural areas, urban edges) relative to natural habitats. By comparing selection patterns across species and regions, we will assess how habitat preferences vary with human influence.

## Results

## Discussion

* Wortlimit mit Patrick besprechen
* Runder Bericht in dem die research questions zu Ende beantwortet werden

## Appendix

### Wordcount

<!-- after installing the wordcountadding (see https://github.com/benmarwick/wordcountaddin), remove the line "#| eval: false" -->

```{r}
wordcountaddin::word_count("index.qmd")
```

### Use of Large Language Models and Generative AI

Elke used @notebooklm for interactively querying the set of research papers cited in the references.

